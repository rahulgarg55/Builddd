var cfg=require("../../../pbx_config"),app=require("express"),fs=require("fs"),pbx_logger=require("../logger/pbx_logger.js"),request=require("request"),dt=require("../common/datetime.js"),logger=new pbx_logger,dateTime=new dt;function pbx_api(){if(!(this instanceof pbx_api))return logger.log("IMP",channel,"api","========================return new api instance NEW====================="),new pbx_api}(module.exports=pbx_api).prototype.getFreeAgent=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u){logger.log("IMP",t,"api","Internal Function [getFreeAgent]");dateTime.getAgentDateTime(),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sme_id: "+e),logger.log("DEB",t,"api","group: "+o),logger.log("DEB",t,"api","alogtype: "+l),logger.log("DEB",t,"api","customerNumber: "+g),logger.log("DEB",t,"api","agent_ignore_list: "+a),logger.log("DEB",t,"api","sme_sticky_algo: "+i),logger.log("DEB",t,"api","assigned_agent_sticky_type: "+r),logger.log("DEB",t,"api","assigned_agent_id: "+n),logger.log("DEB",t,"api","agentAssignedVNAgentID: "+s),logger.log("DEB",t,"api","sessionid: "+c),logger.log("DEB",t,"api","queueName: "+p),logger.log("DEB",t,"api","queueId: "+d);p=cfg.ivr_api.url_v2+"/"+e+"/getFreeAgent",logger.log("DEB",t,"api","HTML Request: "+p),e={url:p,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:c},json:{group:o,alogtype:l,customer_no:g,sme_sticky_algo:i,agent_ignore_list:a,assigned_lead_agent_id:a,assigned_agent_sticky_type:r,assigned_agent_sticky_id:n,assigned_vn_agent_id:s,queue_id:d}};request(e,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","getFreeAgent Error thrown at url call"+e):logger.log("DEB",t,"api","getFreeAgent HTML Received: "+l),u(e,o,l)})},pbx_api.prototype.getFreeAgentParallelRinging=function(t,e,o,l,g,a,i,r,n,s,c,p){logger.log("IMP",t,"api","Internal Function [getFreeAgentParallelRinging]");dateTime.getAgentDateTime(),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sme_id: "+e),logger.log("DEB",t,"api","group: "+o),logger.log("DEB",t,"api","alogtype: "+l),logger.log("DEB",t,"api","customerNumber: "+g),logger.log("DEB",t,"api","agent_ignore_list: "+a),logger.log("DEB",t,"api","sme_sticky_algo: "+i),logger.log("DEB",t,"api","total_agents: "+r),logger.log("DEB",t,"api","sessionid: "+n),logger.log("DEB",t,"api","queueName: "+s),logger.log("DEB",t,"api","queueId: "+c);s=cfg.ivr_api.url+"/"+e+"/getFreeAgentParallelRinging",logger.log("DEB",t,"api","HTML Request: "+s),e={url:s,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:n},json:{group:o,alogtype:l,customer_no:g,sme_sticky_algo:i,total_agents:r,agent_ignore_list:a,queue_id:c}};request(e,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","getFreeAgentParallelRinging Error thrown at url call"+e):logger.log("DEB",t,"api","getFreeAgentParallelRinging HTML Received: "+l),p(e,o,l)})},pbx_api.prototype.setAgentFree=function(t,e,o,l,g,a,i,r){logger.log("IMP",t,"api","Internal Function [setAgentFree]"),logger.log("DEB",t,"api","agent_id: "+e),logger.log("DEB",t,"api","cat_desc: "+o),logger.log("DEB",t,"api","agent_repeatid: "+l),logger.log("DEB",t,"api","flag: "+g),logger.log("DEB",t,"api","alogtype: "+a),logger.log("DEB",t,"api","sessionid: "+i);o=cfg.ivr_api.url+"/"+e+"/setAgentFree",logger.log("DEB",t,"api","HTML Request: "+o),l={url:o,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:i},json:{}};request(l,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","setAgentFree Error thrown at url call"+e):logger.log("DEB",t,"api","setAgentFree HTML Received: "+l),r(e,o,l)})},pbx_api.prototype.checkAgentStatus=function(t,e,o,l,g,a,i,r,n){logger.log("IMP",t,"api","Internal Function [checkAgentStatus]"),logger.log("DEB",t,"api","agent_id: "+e),logger.log("DEB",t,"api","cat_desc: "+o),logger.log("DEB",t,"api","agent_repeatid: "+l),logger.log("DEB",t,"api","flag: "+g),logger.log("DEB",t,"api","alogtype: "+a),logger.log("DEB",t,"api","sessionid: "+r);r=cfg.server.protocol+"://"+cfg.server.ip+":"+cfg.server.port+"/"+cfg.server.services_name+"/getAgentDetails?smeid="+e+"&catdesc="+o+"&agentrepeatid="+l+"&flag="+g+"&alogtype="+a+"&customerNumber="+i,logger.log("DEB",t,"api","HTML Request: "+r),e={url:r,headers:{"User-Agent":"request"}};request(e,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","checkAgentStatus Error thrown at url call"+e):logger.log("DEB",t,"api","checkAgentStatus HTML Received: "+l),n(e,o,l)})},pbx_api.prototype.logCallCdr=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E,m,B,T,f,_,S,k,v,R,I,h,y,C,M,A,F,q,b){logger.log("IMP",t,"api","Internal Function [logCallCdr]"),logger.log("DEB",t,"api","sessionid: "+q);q=cfg.server.protocol+"://"+cfg.server.ip+":"+cfg.server.port+"/"+cfg.server.services_name+"/setIvrCdr?agentGroup="+e+"&callDirection="+o+"&callDirectionStatus="+l+"&callRecordedFile="+g+"&callRecordingStatus="+a+"&calledNumber="+i+"&callingNumber="+r+"&cdrMode="+n+"&channelNo="+s+"&duration="+c+"&endDateTime="+p+"&hlr="+d+"&insertDateTime="+u+"&longcode="+D+"&masterShortcode="+E+"&patchedAgentId="+m+"&serverIpAddress="+B+"&shortcodeMapping="+T+"&smeId="+f+"&smeIdentifier="+_+"&startDateTime="+S+"&voicemailRecordingFile="+k+"&voicemailRecordingStatus="+v+"&groupid="+R+"&callid="+I+"&cdrFlag="+h+"&answerFlag="+y+"&callStatus="+C+"&disconnectedBy="+M+"&customerName="+A+"&addressBookId="+F,logger.log("DEB",t,"api","HTML Request: "+q),e={url:q,headers:{"User-Agent":"request"}};request(e,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","logCallCdr Error thrown at url call"+e):logger.log("DEB",t,"api","logCallCdr HTML Received: "+l),b(e,o,l)})},pbx_api.prototype.logCallCdrNew=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E,m,B,T,f,_,S,k,v,R,I,h,N,y,C,M,j,H,A,F,q,b,L,P,w,x,O,U,V,G,K,W,z,J){logger.log("IMP",t,"api","Internal Function [logCallCdrNew]");var Q=dateTime.getAgentDateTime(),u=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","addressBookId: "+q),logger.log("DEB",t,"api","agentGroup: "+e),logger.log("DEB",t,"api","answer: "+y),logger.log("DEB",t,"api","callDirection: "+o),logger.log("DEB",t,"api","callDirectionStatus: "+l),logger.log("DEB",t,"api","callSessionId: "+h),logger.log("DEB",t,"api","callRecordedFile: "+g),logger.log("DEB",t,"api","callRecordingStatus: "+a),logger.log("DEB",t,"api","callStatus: "+C),logger.log("DEB",t,"api","agentNumber: "+i),logger.log("DEB",t,"api","customerNumber: "+r),logger.log("DEB",t,"api","cdrMode: "+n),logger.log("DEB",t,"api","callModeNew: "+x),logger.log("DEB",t,"api","channelNo: "+s),logger.log("DEB",t,"api","CustomerConnectedDuration: "+F),logger.log("DEB",t,"api","CustomerRingingDuration: "+A),logger.log("DEB",t,"api","duration: "+c),logger.log("DEB",t,"api","disconnectedBy: "+M),logger.log("DEB",t,"api","callendDateTime: "+p),logger.log("DEB",t,"api","endDateTimeS: "+p),logger.log("DEB",t,"api","groupid: "+I),logger.log("DEB",t,"api","hlr: "+d),logger.log("DEB",t,"api","insertDateTime: "+u),logger.log("DEB",t,"api","insertDateTimeS: "+u),logger.log("DEB",t,"api","longcode: "+D),logger.log("DEB",t,"api","masterShortcode: "+E),logger.log("DEB",t,"api","patchedAgentId: "+m),logger.log("DEB",t,"api","patchedAgentName: "+B),logger.log("DEB",t,"api","serverIpAddress: "+T),logger.log("DEB",t,"api","shortcodeMapping: "+f),logger.log("DEB",t,"api","smeId: "+_),logger.log("DEB",t,"api","smeIdentifier: "+S),logger.log("DEB",t,"api","startDateTime: "+k),logger.log("DEB",t,"api","startDateTimeS: "+k),logger.log("DEB",t,"api","voicemailRecordingFile: "+v),logger.log("DEB",t,"api","voicemailRecordingStatus: "+R),logger.log("DEB",t,"api","callMode: "+b),logger.log("DEB",t,"api","endCallDescription: "+L),logger.log("DEB",t,"api","IvrCallDuration: "+P),logger.log("DEB",t,"api","callBlackListCustomerFlag: "+w),logger.log("DEB",t,"api","callFlowId: "+O),logger.log("DEB",t,"api","gflowName: "+U),logger.log("DEB",t,"api","endCallProvisionalFlag: "+V),logger.log("DEB",t,"api","finalDTMF: "+G),logger.log("DEB",t,"api","sessionid: "+K),logger.log("DEB",t,"api","queueName: "+W),logger.log("DEB",t,"api","queueId: "+z),cfg.ivr_api.url_v3+"/"+_+"/endCallCdr"),u=(logger.log("DEB",t,"api","HTML Request: "+u),{url:u,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:K},json:{addressBookId:q,agentGroup:e,answer:y,callDirection:o,callDirectionStatus:l,session_id:h,callRecordedFile:g,callRecordingStatus:a,callStatus:C,merge_status:"0",remarks:"",agentNumber:i,agent_name:B,customerNumber:r,cdrMode:n,channelNo:s,connectedDuration:F,customerName:"0",disconnectedBy:M,duration:c,endDateTime:p,insertDateTime:Q,startDateTime:k,groupId:I,hlr:d,id:"0",longcode:D,masterShortcode:E,patchedAgentId:m,ringingDuration:A,serverIpAddress:T,shortcodeMapping:f,smeId:_,smeIdentifier:S,voicemailRecordingFile:v,voicemailRecordingStatus:R,callMode:b,callType:b,callModeDb:x,ivrDuration:P,callDescription:L,customerStatus:w,callflowId:O,callflowName:U,provisionalFlag:V,finalDTMF:G,queue_id:z,queue_name:W}});request(u,function(e,o,l){(e||200!=o.statusCode)&&logger.log("ERR",t,"api","logCallCdrNew Error thrown at url call"+e),J(e,o,l)})},pbx_api.prototype.notifyAutodialer=function(t,e,o,g){logger.log("IMP",t,"api","Internal Function [notifyAutodialer]"),logger.log("DEB",t,"api","callScheduleId: "+e),logger.log("DEB",t,"api","sessionid: "+o);o=cfg.server.crm_api_protocol+"://"+cfg.server.crm_api_ip+":"+cfg.server.crm_api_port+"/crm/api/v1/initaile/call/schedule/"+e+"/callback/",logger.log("DEB",t,"api","HTML Request: "+o),e={url:o,headers:{Accept:"*/*"}};request(e,function(e,o,l){(e||200!=o.statusCode)&&logger.log("ERR",t,"api","Error thrown at url call"+e),g(e,o,l)})},pbx_api.prototype.pushLiveEvent=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E){logger.log("IMP",t,"api","Internal Function [pushLiveEvent]");var m=i.getAgentDateTime(),B=(SecretToken=i.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","accountSid("+e+")"),logger.log("DEB",t,"api","agentNumber("+o+")"),logger.log("DEB",t,"api","callMode("+l+")"),logger.log("DEB",t,"api","callType("+g+")"),logger.log("DEB",t,"api","customDtmf("+a+")"),logger.log("DEB",t,"api","dateTime("+i+")"),logger.log("DEB",t,"api","from("+r+")"),logger.log("DEB",t,"api","liveEvent("+n+")"),logger.log("DEB",t,"api","recordingFile("+s+")"),logger.log("DEB",t,"api","responseMsg("+c+")"),logger.log("DEB",t,"api","sessionId("+p+")"),logger.log("DEB",t,"api","smeId("+d+")"),logger.log("DEB",t,"api","to("+u+")"),logger.log("DEB",t,"api","sessionid: "+D),cfg.server.crm_api_protocol+"://"+cfg.server.crm_api_ip+":"+cfg.server.crm_api_port+"/crm/api/v1/call/event/callback"),B=(logger.log("DEB",t,"api","HTML Request: "+B),{url:B,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:D},json:{accountSid:""+e,agentNumber:""+o,callMode:l,callType:g,customDtmf:""+a,dateTime:""+i,from:""+r,liveEvent:""+n,recordingFile:s,responseMsg:""+c,sessionId:""+p,smeId:""+d,insertDateTime:m,to:""+u}});request(B,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","Error thrown at url call"+e):(logger.log("DEB",t,"api","pushLiveEvent response: "+o),logger.log("DEB",t,"api","pushLiveEvent html: "+l)),E(e,o,l)})},pbx_api.prototype.updateUniqueCallDetails=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E,m,B,T,f,_,S,k,v,R,I,h,y,C,M,A,F,N,j,H,q,b,L,w){logger.log("IMP",t,"api","Internal Function [updateUniqueCallDetails]");var x=dateTime.getAgentDateTime(),P=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+q),logger.log("DEB",t,"api","queueName: "+b),logger.log("DEB",t,"api","queueId: "+L),logger.log("DEB",t,"api","patchedAgentName: "+B),cfg.ivr_api.url_v3+"/"+_+"/setUniqueCalls"),P=(logger.log("DEB",t,"api","HTML Request: "+P),{url:P,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:q},json:{channel:t,callpatchedAgentGroup:e,callDirection:o,callDirectionStatus:l,callRecordedFile:g,callRecordingStatus:a,customerNumber:r,agentNumber:i,callcdrMode:n,callModeDb:j,callchannelNo:s,callDuration:c,callendDateTime:p,callHlr:d,callinsertDateTime:u,calllongcode:D,callmasterShortcode:E,callpatchedAgentId:m,agent_name:B,ip:T,callshortcodeMapping:f,smeID:_,callsmeIdentifier:S,callstartDateTime:k,voicemailRecordingFile:v,voicemailRecordingStatus:R,callgroupid:I,callSessionId:h,callcdrFlag:y,callanswerFlag:C,callfinalStatus:M,calldisconnectedBy:A,addressBookName:F,addressBookId:N,endCallProvisionalFlag:H,insertDateTime:x,queue_id:L,queue_name:b}});request(P,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","updateUniqueCallDetails Error thrown at url call"+e):logger.log("DEB",t,"api","updateUniqueCallDetails HTML Received: "+l),w(e,o,l)})},pbx_api.prototype.funFetchCallProfile=function(t,e,o,l,g,a){logger.log("IMP",t,"api","Internal Function [funFetchCallProfile]");var i=dateTime.getAgentDateTime(),r=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","timeout ("+cfg.ivr_api.timeout+")"),logger.log("DEB",t,"api","sessionid: "+g),cfg.ivr_api.url_v2+"/fetchCallProfile"),r=(logger.log("DEB",t,"api","HTML Request: "+r),{url:r,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:g},json:{callingNumber:e,longcode:o,insertDateTime:i,ipAddress:l}});request(r,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funFetchCallProfile Error thrown at url call"+e):logger.log("DEB",t,"api","funFetchCallProfile HTML Received: "+l),a(e,o,l)})},pbx_api.prototype.funSetLiveCalls=function(t,e,o,l,g,a,i,r,n,s,c,p,d){logger.log("IMP",t,"api","Internal Function [funSetLiveCalls]");var u=dateTime.getAgentDateTime(),n=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","gDateTime: "+e),logger.log("DEB",t,"api","longcode: "+o),logger.log("DEB",t,"api","sessionid: "+p),logger.log("DEB",t,"api","sessionid: "+p),logger.log("DEB",t,"api","sessionid: "+p),logger.log("DEB",t,"api","callStatus: "+r),logger.log("DEB",t,"api","callType: "+c),cfg.ivr_api.url_live_calls+"/"+n+"/setLiveCalls"),n=(logger.log("DEB",t,"api","HTML Request: "+n),{url:n,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:p},json:{date_time:e,longcode:o,customer_number:g,agent_number:a,self_ip:s,agent_id:i,session_id:l,call_status:r,address_book_id:0,customer_name:"",insertDateTime:u,call_type:c}});request(n,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funSetLiveCalls Error thrown at url call"+e):logger.log("DEB",t,"api","funSetLiveCalls HTML Received: "+l),d(e,o,l)})},pbx_api.prototype.funUpdateLiveCalls=function(t,e,o,l,g,a,i,r,n,s,c,p,d){logger.log("IMP",t,"api","Internal Function [funUpdateLiveCalls]"),logger.log("DEB",t,"api","callStatus("+a+")");var u=dateTime.getAgentDateTime(),i=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+r),cfg.ivr_api.url_live_calls+"/"+i+"/updateLiveCalls"),i=(logger.log("DEB",t,"api","HTML Request: "+i),{url:i,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:r},json:{customer_number:o,agent_number:l,agent_id:g,session_id:e,call_status:a,insertDateTime:u,date_time:n,longcode:s,self_ip:c,address_book_id:0,customer_name:"",call_type:p}});request(i,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funUpdateLiveCalls Error thrown at url call"+e):logger.log("DEB",t,"api","funUpdateLiveCalls HTML Received: "+l),d(e,o,l)})},pbx_api.prototype.funDeleteLiveCalls=function(t,e,o,l,g){logger.log("IMP",t,"api","Internal Function [funDeleteLiveCalls]");var a=dateTime.getAgentDateTime(),i=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+l),cfg.ivr_api.url_live_calls+"/"+o+"/deleteLiveCalls"),i=(logger.log("DEB",t,"api","HTML Request: "+i),{url:i,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:l},json:{session_id:e,sme_id:o,insertDateTime:a}});request(i,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funDeleteLiveCalls Error thrown at url call"+e):logger.log("DEB",t,"api","funDeleteLiveCalls HTML Received: "+l),g(e,o,l)})},pbx_api.prototype.funUploadRecording=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E){logger.log("IMP",t,"api","Internal Function [funUploadRecording]");var m=dateTime.getAgentDateTime(),l=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+D),cfg.ivr_api.url+"/"+l+"/uploadRecording?in_flag="+e+"&in_call_id="+o+"&in_agent_id="+g+"&in_customer_ani="+a+"&in_duration="+(i=0==i?"0":i)+"&in_filename="+r+"&in_status="+n+"&in_flag_tbl="+s+"&in_ip="+c+"&insertDateTime="+m+"&session_id="+d+"&call_direction="+u),m=(logger.log("DEB",t,"api","URL: "+l),logger.log("DEB",t,"api","FilePath: "+p),logger.log("DEB",t,"api","AgentFlag: "+e),logger.log("DEB",t,"api","callRecordedFileRaw: "+o),logger.log("DEB",t,"api","idealAgentID: "+g),logger.log("DEB",t,"api","customerNumber: "+a),logger.log("DEB",t,"api","AgentCallDuration: "+i),logger.log("DEB",t,"api","RecordingFile: "+r),logger.log("DEB",t,"api","RecStatus: "+n),logger.log("DEB",t,"api","InsertFlag: "+s),logger.log("DEB",t,"api","self_ip: "+c),logger.log("DEB",t,"api","callSessionId: "+d),logger.log("DEB",t,"api","call_direction: "+u),logger.log("DEB",t,"api","sessionid: "+D),{url:l,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"Content-Type":"multipart/form-data",token:SecretToken,sessionId:D},formData:{kservice_file:{value:fs.createReadStream(p),options:{filename:"",contentType:null}}}});request(m,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funSaveRecording Error thrown at url call"+e):logger.log("DEB",t,"api","funSaveRecording HTML Received: "+l),E(e,o,l)})},pbx_api.prototype.funSaveRecordingData=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E){logger.log("IMP",t,"api","Internal Function [funSaveRecordingData]");var m=dateTime.getAgentDateTime(),l=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),0==i&&(i="0"),cfg.ivr_api.url_v2+"/"+l+"/saveRecordingData"),p=(logger.log("DEB",t,"api","URL: "+l),logger.log("DEB",t,"api","FilePath: "+p),logger.log("DEB",t,"api","AgentFlag: "+e),logger.log("DEB",t,"api","callRecordedFileRaw: "+o),logger.log("DEB",t,"api","idealAgentID: "+g),logger.log("DEB",t,"api","customerNumber: "+a),logger.log("DEB",t,"api","AgentCallDuration: "+i),logger.log("DEB",t,"api","RecordingFile: "+r),logger.log("DEB",t,"api","RecStatus: "+n),logger.log("DEB",t,"api","InsertFlag: "+s),logger.log("DEB",t,"api","self_ip: "+c),logger.log("DEB",t,"api","callSessionId: "+d),logger.log("DEB",t,"api","call_direction: "+u),logger.log("DEB",t,"api","sessionid: "+D),{url:l,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:D},json:{in_flag:e,in_call_id:o,in_agent_id:g,in_customer_ani:a,in_duration:i,in_filename:r,in_status:n,in_flag_tbl:s,in_ip:c,insertDateTime:m,session_id:d,call_direction:u}});request(p,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funSaveRecordingData Error thrown at url call"+e):logger.log("DEB",t,"api","funSaveRecordingData HTML Received: "+l),E(e,o,l)})},pbx_api.prototype.funSaveFailedRecordingData=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E){logger.log("IMP",t,"api","Internal Function [funSaveFailedRecordingData]");var m=dateTime.getAgentDateTime(),l=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),0==i&&(i="0"),cfg.ivr_api.url+"/"+l+"/saveFailedRecordingInfo"),p=(logger.log("DEB",t,"api","URL: "+l),logger.log("DEB",t,"api","FilePath: "+p),logger.log("DEB",t,"api","AgentFlag: "+e),logger.log("DEB",t,"api","callRecordedFileRaw: "+o),logger.log("DEB",t,"api","idealAgentID: "+g),logger.log("DEB",t,"api","customerNumber: "+a),logger.log("DEB",t,"api","AgentCallDuration: "+i),logger.log("DEB",t,"api","RecordingFile: "+r),logger.log("DEB",t,"api","RecStatus: "+n),logger.log("DEB",t,"api","InsertFlag: "+s),logger.log("DEB",t,"api","self_ip: "+c),logger.log("DEB",t,"api","callSessionId: "+d),logger.log("DEB",t,"api","call_direction: "+u),logger.log("DEB",t,"api","sessionid: "+D),{url:l,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:D},json:{in_flag:e,in_call_id:o,in_agent_id:g,in_customer_ani:a,in_duration:i,in_filename:r,in_status:n,in_flag_tbl:s,in_ip:c,insertDateTime:m,in_session_id:d,call_direction:u}});request(p,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funSaveFailedRecordingData Error thrown at url call"+e):logger.log("DEB",t,"api","funSaveFailedRecordingData HTML Received: "+l),E(e,o,l)})},pbx_api.prototype.funSetAgentCdr=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E,m,B,T,f,_,S,k){logger.log("IMP",t,"api","Internal Function [funSetAgentCdr]");var v=dateTime.getAgentDateTime(),o=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),cfg.ivr_api.url+"/"+o+"/setAgentCdr"),o=(logger.log("DEB",t,"api","HTML Request: "+o),logger.log("DEB",t,"api","inflag: "+e),logger.log("DEB",t,"api","agentgroup: "+s),logger.log("DEB",t,"api","agentId: "+l),logger.log("DEB",t,"api","groupId: "+s),logger.log("DEB",t,"api","status: "+g),logger.log("DEB",t,"api","responseCode: "+a),logger.log("DEB",t,"api","duration: "+n),logger.log("DEB",t,"api","endDate: "+r),logger.log("DEB",t,"api","startDate: "+i),logger.log("DEB",t,"api","customerAni: "+c),logger.log("DEB",t,"api","sessionCall: "+p),logger.log("DEB",t,"api","mode: "+d),logger.log("DEB",t,"api","callInfo: "+u),logger.log("DEB",t,"api","connectedDuration: "+E),logger.log("DEB",t,"api","ringingDuration: "+D),logger.log("DEB",t,"api","insertDateTime: "+v),logger.log("DEB",t,"api","callRouteReason: "+m),logger.log("DEB",t,"api","overallCallStatus: "+B),logger.log("DEB",t,"api","agentNumber: "+T),logger.log("DEB",t,"api","sessionid: "+f),logger.log("DEB",t,"api","queueName: "+_),logger.log("DEB",t,"api","queueId: "+S),{url:o,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:f},json:{inflag:e,agentgroup:s,agentId:l,groupId:s,status:g,responseCode:a,duration:n,endDate:r,startDate:i,customerAni:c,sessionCall:p,mode:d,callInfo:u,connectedDuration:E,ringingDuration:D,callRouteReason:m,overallCallStatus:B,insertDateTime:v,agentNumber:T,queue_id:S,queue_name:_}});request(o,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funSetAgentCdr Error thrown at url call err("+e+"), response("+o+"), html("+l+")"):logger.log("DEB",t,"api","funSetAgentCdr HTML Received: "+l),k(e,o,l)})},pbx_api.prototype.funGetAppOutCallDetail=function(t,e,o,l,g,a){logger.log("IMP",t,"api","Internal Function [funGetAppOutCallDetail]");var i=dateTime.getAgentDateTime(),e=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+g),cfg.ivr_api.url+"/"+e+"/getAppOutCallDetail"),e=(logger.log("DEB",t,"api","HTML Request: "+e),logger.log("DEB",t,"api","agent_no: "+o),logger.log("DEB",t,"api","longcode: "+l),logger.log("DEB",t,"api","insertDateTime: "+i),{url:e,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:g},json:{agent_no:o,longcode:l,insertDateTime:i}});request(e,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funGetAppOutCallDetail Error thrown at url call"+e):logger.log("DEB",t,"api","funGetAppOutCallDetail HTML Received: "+l),a(e,o,l)})},pbx_api.prototype.checkValidAgentExt=function(t,e,o,l,g){logger.log("IMP",t,"api","Internal Function [checkValidAgentExt]");var a=dateTime.getAgentDateTime(),i=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+l),cfg.ivr_api.url+"/"+e+"/agentExtention"),e=(logger.log("DEB",t,"api","HTML Request: "+i),logger.log("DEB",t,"api","smeID: "+e),logger.log("DEB",t,"api","agentExt: "+o),logger.log("DEB",t,"api","insertDateTime: "+a),{url:i,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:l},json:{in_agent_ext:o,insertDateTime:a}});request(e,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","checkValidAgentExt Error thrown at url call"+e):logger.log("DEB",t,"api","checkValidAgentExt HTML Received: "+l),g(e,o,l)})},pbx_api.prototype.checkKeepAlive=function(t,e,g){logger.log("IMP",t,"api","Internal Function [checkKeepAlive]");var o=dateTime.getAgentDateTime(),l=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+e),cfg.ivr_api.url+"/keepAlive"),l=(logger.log("DEB",t,"api","HTML Request: "+l),logger.log("DEB",t,"api","dateTime: "+o),{url:l,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:e},json:{dateTime:o}});request(l,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","checkKeepAlive Error thrown at url call"+e):logger.log("DEB",t,"api","checkKeepAliveHTML Received: "+l),g(e,o,l)})},pbx_api.prototype.notifyCustomerCrmDialer=function(t,e,o,l,g,a){logger.log("IMP",t,"api","Internal Function [notifyCustomerCrmDialer]"),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+g);e=cfg.crm_api.url+"/"+e+"/schedule/sendIvrOutgoingcallback",logger.log("DEB",t,"api","HTML Request: "+e),e={url:e,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:g},json:{callScheduleId:o,sessionId:l}};request(e,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","notifyCustomerCrmDialer Error thrown at url call"+e):logger.log("DEB",t,"api","notifyCustomerCrmDialer HTML Received: "+l),a(e,o,l)})},pbx_api.prototype.funcNotifyCrmIncomingCallsApi=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E,m,B,T,f,_,S,k){logger.log("IMP",t,"api","Internal Function [funcNotifyCrmIncomingCallsApi]"),logger.log("DEB",t,"api","Inside notifyAutodialer"),logger.log("DEB",t,"api","event_name("+e+")"),logger.log("DEB",t,"api","crm_partner("+o+")"),logger.log("DEB",t,"api","sme_id("+l+")"),logger.log("DEB",t,"api","account_sid("+g+")"),logger.log("DEB",t,"api","session_id("+a+")"),logger.log("DEB",t,"api","recording_file_id("+i+")"),logger.log("DEB",t,"api","recording_file_url("+r+")"),logger.log("DEB",t,"api","agent_no("+n+")"),logger.log("DEB",t,"api","customer_no("+s+")"),logger.log("DEB",t,"api","longcode("+c+")"),logger.log("DEB",t,"api","start_datetime("+p+")"),logger.log("DEB",t,"api","end_datetime("+d+")"),logger.log("DEB",t,"api","call_type("+u+")"),logger.log("DEB",t,"api","call_mode("+D+")"),logger.log("DEB",t,"api","call_status("+E+")"),logger.log("DEB",t,"api","call_duration("+m+")"),logger.log("DEB",t,"api","custom_dtmf("+B+")"),logger.log("DEB",t,"api","optional_field("+T+")"),logger.log("DEB",t,"api","response_msg("+f+")"),logger.log("DEB",t,"api","kommSessionId("+_+")"),logger.log("DEB",t,"api","connectedAgentNumber("+S+")"),logger.log("DEB",t,"api","sessionid: "+k),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")");o=cfg.crm_api.url+"/"+l+"/schedule/sendIvrLiveEvent",logger.log("DEB",t,"api","HTML Request: "+o),i={url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:k},json:{liveEvent:e,accountSid:g,sessionId:a,to:c,from:s,dateTime:p,customDtmf:B,recordingFile:r,responseMsg:f,agentNumber:n,callMode:D,callType:u,kommSessionId:_,call_status:E,call_duration:m,startTime:p,endTime:d,connectedAgentNumber:S}};request(i,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funcNotifyCrmIncomingCallsApi Error thrown at url call"+e):logger.log("DEB",t,"api","funcNotifyCrmIncomingCallsApi HTML Received: "+l)})},pbx_api.prototype.funcNotifyCrmIvrRecordingEvent=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E,m,B,T,f,_,S,k){logger.log("IMP",t,"api","Internal Function [funcNotifyCrmIvrRecordingEvent]"),logger.log("DEB",t,"api","Inside notifyAutodialer"),logger.log("DEB",t,"api","event_name("+e+")"),logger.log("DEB",t,"api","crm_partner("+o+")"),logger.log("DEB",t,"api","sme_id("+l+")"),logger.log("DEB",t,"api","account_sid("+g+")"),logger.log("DEB",t,"api","session_id("+a+")"),logger.log("DEB",t,"api","recordingId("+S+")"),logger.log("DEB",t,"api","recording_file_url("+r+")"),logger.log("DEB",t,"api","agent_no("+n+")"),logger.log("DEB",t,"api","customer_no("+s+")"),logger.log("DEB",t,"api","longcode("+c+")"),logger.log("DEB",t,"api","start_datetime("+p+")"),logger.log("DEB",t,"api","end_datetime("+d+")"),logger.log("DEB",t,"api","call_type("+u+")"),logger.log("DEB",t,"api","call_mode("+D+")"),logger.log("DEB",t,"api","call_status("+E+")"),logger.log("DEB",t,"api","call_duration("+m+")"),logger.log("DEB",t,"api","custom_dtmf("+B+")"),logger.log("DEB",t,"api","optional_field("+T+")"),logger.log("DEB",t,"api","response_msg("+f+")"),logger.log("DEB",t,"api","kommSessionId("+_+")"),logger.log("DEB",t,"api","sessionid: "+k),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")");function v(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funcNotifyCrmIvrRecordingEvent Error thrown at url call"+e):logger.log("DEB",t,"api","funcNotifyCrmIvrRecordingEvent HTML Received: "+l)}o=cfg.crm_api.url+"/"+l+"/schedule/sendIvrRecordingEvent";logger.log("DEB",t,"api","HTML Request: "+o);const R={url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:k},json:{liveEvent:e,accountSid:g,sessionId:a,to:c,from:s,dateTime:p,customDtmf:B,recordingFile:r,recordingId:S,responseMsg:f,agentNumber:n,callMode:D,callType:u,kommSessionId:_}};setTimeout(()=>{request(R,v)},5e3)},pbx_api.prototype.sendEndCallNotification=function(t,e,o,l,g,a,i,r,n,s){logger.log("IMP",t,"api","Internal Function [sendEndCallNotification]");var c=dateTime.getAgentDateTime(),o=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+n),cfg.ivr_api.url+"/"+o+"/callEndIvrNotify"),o=(logger.log("DEB",t,"api","HTML Request: "+o),{url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:n},json:{callType:e,sessionId:l,agentId:g,customerName:a,customerNumber:i,mode:r,dateTime:c}});request(o,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","sendEndCallNotification Error thrown at url call"+e):logger.log("DEB",t,"api","sendEndCallNotification sent successfully "+l)})},pbx_api.prototype.sendEndCallSMS=function(t,e,o,l,g,a,i,r,n,s){logger.log("IMP",t,"api","Internal Function [sendEndCallSMS]");var c=dateTime.getAgentDateTime(),o=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","callType("+e+")"),logger.log("DEB",t,"api","smeId("+o+")"),logger.log("DEB",t,"api","callStatus("+l+")"),logger.log("DEB",t,"api","customerNo("+g+")"),logger.log("DEB",t,"api","agentName("+i+")"),logger.log("DEB",t,"api","agentNo("+a+")"),logger.log("DEB",t,"api","duration("+r+")"),logger.log("DEB",t,"api","sessionid: "+n),cfg.ivr_api.url+"/"+o+"/sendEndcallSms"),o=(logger.log("DEB",t,"api","HTML Request: "+o),{url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:n},json:{callType:e,callStatus:l,customerNo:g,agentNo:a,agentName:i,duration:r,dateTime:c}});request(o,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","sendEndCallSMS Error thrown at url call"+e):logger.log("DEB",t,"api","sendEndCallSMS sent successfully "+l)})},pbx_api.prototype.sendEndCallSmsExternal=function(t,e,o,l,g,a,i,r,n,s){logger.log("IMP",t,"api","Internal Function [sendEndCallSmsExternal]");var c=dateTime.getAgentDateTime(),o=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","callType("+e+")"),logger.log("DEB",t,"api","smeId("+o+")"),logger.log("DEB",t,"api","callStatus("+l+")"),logger.log("DEB",t,"api","customerNo("+g+")"),logger.log("DEB",t,"api","agentName("+i+")"),logger.log("DEB",t,"api","agentNo("+a+")"),logger.log("DEB",t,"api","duration("+r+")"),logger.log("DEB",t,"api","sessionid: "+n),cfg.thirdParty_sms_api.url+"/"+o+"/sendThirdPartyEndcallSms"),o=(logger.log("DEB",t,"api","HTML Request: "+o),{url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:n},json:{callType:e,callStatus:l,customerNo:g,agentNo:a,agentName:i,duration:r,dateTime:c}});request(o,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","sendEndCallSmsExternal Error thrown at url call"+e):logger.log("DEB",t,"api","sendEndCallSmsExternal sent successfully "+l)})},pbx_api.prototype.funSetAgentBusy=function(t,e,o,l,g){logger.log("IMP",t,"api","Internal Function [funSetAgentBusy]");var a=dateTime.getAgentDateTime(),o=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+l),cfg.ivr_api.url+"/"+o+"/setAgentOutInfo"),o=(logger.log("DEB",t,"api","HTML Request: "+o),{url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:l},json:{agentNumber:e,insertDateTime:a}});request(o,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funSetAgentBusy Error thrown at url call"+e):(console.log("html.status: "+l.status),console.log("html.message: "+l.message),logger.log("DEB",t,"api","funSetAgentBusy HTML Received: "+l)),g(e,o,l)})},pbx_api.prototype.funSetCustomerCdr=function(t,e,o,l,g,a,i,r,n,s,c,p,d,u,D,E,m){logger.log("IMP",t,"api","Internal Function [funSetCustomerCdr]");var B=dateTime.getAgentDateTime(),o=(SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+E),cfg.ivr_api.url+"/"+o+"/setCustomerCdr"),o=(logger.log("DEB",t,"api","HTML Request: "+o),{url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:E},json:{inflag:e,status:l,responseCode:g,endDate:i,startDate:a,customerAni:n,sessionCall:s,mode:c,callInfo:p,connectedDuration:u,ringingDuration:d,totalDuration:r,callRouteReason:D,insertDateTime:B}});request(o,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","funSetCustomerCdr Error thrown at url call"+e):logger.log("DEB",t,"api","funSetCustomerCdr HTML Received: "+l),m(e,o,l)})},pbx_api.prototype.updateCallBalance=function(t,e,o,l,g,a){logger.log("IMP",t,"api","Internal Function [updateCallBalance]");dateTime.getAgentDateTime(),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+g);l=cfg.ivr_api.url+"/"+l+"/updateCallBalance",logger.log("DEB",t,"api","HTML Request: "+l),l={url:l,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:g},json:{callDuration:e,calls_type:o}};request(l,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","updateCallBalance Error thrown at url call"+e):(console.log("html.status: "+l.status),console.log("html.message: "+l.message),logger.log("DEB",t,"api","updateCallBalance HTML Received: "+l)),a(e,o,l)})},pbx_api.prototype.aiBotCallStart=function(t,e,o,l,g,a,i,r,n){logger.log("IMP",t,"api","Internal Function [aiBotCallStart]");dateTime.getAgentDateTime(),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+l);o=cfg.aibot_api.url+"/"+o+"/aiBotCallStart",logger.log("DEB",t,"api","HTML Request: "+o),o={url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:l},json:{callType:e,sessionId:l,eventType:"start",customerName:g,calledNumber:i,callingNumber:a,fileUrl:r}};request(o,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","aiBotCallStart Error thrown at url call"+e):(console.log("html.status: "+l.status),console.log("html.message: "+l.message),logger.log("DEB",t,"api","aiBotCallStart HTML Received: "+l)),n(e,o,l)})},pbx_api.prototype.aiBotStartMedia=function(t,e,o,l,g,a){logger.log("IMP",t,"api","Internal Function [aiBotStartMedia]");dateTime.getAgentDateTime(),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+l);o=cfg.aibot_api.url+"/"+o+"/aiBotSendMedia",logger.log("DEB",t,"api","HTML Request: "+o),o={url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:l},json:{callType:e,sessionId:l,eventType:"media",fileUrl:g}};request(o,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","aiBotStartMedia Error thrown at url call"+e):(console.log("html.status: "+l.status),console.log("html.message: "+l.message),logger.log("DEB",t,"api","aiBotStartMedia HTML Received: "+l)),a(e,o,l)})},pbx_api.prototype.aiBotCallStop=function(t,e,o,l,g,a){logger.log("IMP",t,"api","Internal Function [aiBotCallStop]");dateTime.getAgentDateTime(),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sessionid: "+l);o=cfg.aibot_api.url+"/"+o+"/aiBotCallStop",logger.log("DEB",t,"api","HTML Request: "+o),o={url:o,method:"POST",headers:{"content-type":"application/json",token:SecretToken,sessionId:l},json:{callType:e,sessionId:l,eventType:"stop",fileUrl:g}};request(o,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","aiBotCallStop Error thrown at url call"+e):(console.log("html.status: "+l.status),console.log("html.message: "+l.message),logger.log("DEB",t,"api","aiBotCallStop HTML Received: "+l)),a(e,o,l)})},pbx_api.prototype.getIVRFlow=function(t,e,o,l,g,a,i,r){logger.log("IMP",t,"api","Internal Function [getIVRFlow]");dateTime.getAgentDateTime(),SecretToken=dateTime.generateSecretToken(cfg.secret.days),logger.log("DEB",t,"api","SecretToken ("+SecretToken+")"),logger.log("DEB",t,"api","sme_id: "+e),logger.log("DEB",t,"api","dtmf: "+o),logger.log("DEB",t,"api","ivr_id: "+l),logger.log("DEB",t,"api","end_of_media_flag: "+g),logger.log("DEB",t,"api","retry: "+a);var n=cfg.ivr_api.url_v2+"/getSmeIvrFlow",n=(logger.log("DEB",t,"api","HTML Request: "+n),{url:n,method:"POST",timeout:cfg.ivr_api.timeout,headers:{"content-type":"application/json",token:SecretToken,sessionId:i},json:{sme_id:e,dtmf:o,ivr_id:l,end_of_media_flag:g,retry:a}});request(n,function(e,o,l){e||200!=o.statusCode?logger.log("ERR",t,"api","getIVRFlow Error thrown at url call"+e):(logger.log("DEB",t,"api","getIVRFlow HTML Received: "+l),console.log(l)),r(e,o,l)})};