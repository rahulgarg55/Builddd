var cfg=require("../../pbx_config"),querystring=require("querystring"),pbx_logger=require("./logger/pbx_logger"),pbx_logger=require("./logger/pbx_logger"),express=require("express"),gZmq=require("zeromq"),gSock=gZmq.socket("push"),util=require("util"),logger=new pbx_logger,gDbConn=(module.exports=pbx_zmq,""),gDbPool="";function pbx_zmq(){if(!(this instanceof pbx_zmq))return new pbx_zmq}pbx_zmq.prototype.bind=function(){logger.log("DEB",0,"zmq","host: "+cfg.zmq.ip),logger.log("DEB",0,"zmq","user: "+cfg.zmq.port),logger.log("DEB",0,"zmq","db: "+cfg.zmq.protocol),gSock.connect(cfg.zmq.protocol+"://"+cfg.zmq.ip+":"+cfg.zmq.port)},pbx_zmq.prototype.sendZmqMsg=function(e,g,o,l,r,m,s,t,n,q,i,c,d,z,a,_,u,D,p,B){logger.log("DEB",e,"zmq","Inside notifyAutodialer"),logger.log("DEB",e,"zmq","event_name("+g+")"),logger.log("DEB",e,"zmq","crm_partner("+o+")"),logger.log("DEB",e,"zmq","sme_id("+l+")"),logger.log("DEB",e,"zmq","account_sid("+r+")"),logger.log("DEB",e,"zmq","session_id("+m+")"),logger.log("DEB",e,"zmq","recording_file_id("+s+")"),logger.log("DEB",e,"zmq","recording_file_url("+t+")"),logger.log("DEB",e,"zmq","agent_no("+n+")"),logger.log("DEB",e,"zmq","customer_no("+q+")"),logger.log("DEB",e,"zmq","longcode("+i+")"),logger.log("DEB",e,"zmq","start_datetime("+c+")"),logger.log("DEB",e,"zmq","end_datetime("+d+")"),logger.log("DEB",e,"zmq","call_type("+z+")"),logger.log("DEB",e,"zmq","call_mode("+a+")"),logger.log("DEB",e,"zmq","call_status("+_+")"),logger.log("DEB",e,"zmq","call_duration("+u+")"),logger.log("DEB",e,"zmq","custom_dtmf("+D+")"),logger.log("DEB",e,"zmq","optional_field("+p+")"),logger.log("DEB",e,"zmq","response_msg("+B+")");o={event:""+g,crmPartner:""+o,smeId:""+l,accountSid:""+r,sessionId:""+m,recordingFileId:""+s,recordingFileUrl:""+t,agentNo:""+n,customerNo:""+q,longcode:""+i,startDateTime:""+c,endDateTime:""+d,callType:""+z,callMode:""+a,callStatus:""+_,callDuration:""+u,customDtmf:""+D,optionalField:""+p,responseMsg:""},o.responseMsg=B,l=JSON.stringify(o);gSock.send([""+g,l]),logger.log("DEB",e,"zmq","sent zmq message successfully ZMQ ({"+g+"})")},pbx_zmq.prototype.sendZmgLiveCalls=function(e,g,o,l,r,m,s,t,n,q,i,c,d,z){logger.log("DEB",e,"zmq","Inside sendZmgLiveCalls for event: "+g),logger.log("DEB",e,"zmq","event_name("+g+")"),logger.log("DEB",e,"zmq","sme_id("+o+")"),logger.log("DEB",e,"zmq","date_time("+l+")"),logger.log("DEB",e,"zmq","longcode("+r+")"),logger.log("DEB",e,"zmq","customer_number("+m+")"),logger.log("DEB",e,"zmq","agent_number("+s+")"),logger.log("DEB",e,"zmq","server_ip_address("+t+")"),logger.log("DEB",e,"zmq","agent_id("+n+")"),logger.log("DEB",e,"zmq","session_id("+q+")"),logger.log("DEB",e,"zmq","call_status("+i+")"),logger.log("DEB",e,"zmq","address_book_id("+c+")"),logger.log("DEB",e,"zmq","customer_name("+d+")"),logger.log("DEB",e,"zmq","call_type("+z+")");o=JSON.stringify({event:""+g,smeId:""+o,dateTime:""+l,longcode:""+r,customerNumber:""+m,agentNumber:""+s,serverIpAddress:""+t,agentId:""+n,sessionId:""+q,callStatus:""+i,addressBookId:""+c,customerName:""+d,callType:""+z});gSock.send([""+g,o]),logger.log("DEB",e,"zmq","sent zmq message successfully ZMQ ({"+g+"})")};